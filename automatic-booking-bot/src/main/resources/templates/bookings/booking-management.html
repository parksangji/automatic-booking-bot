<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <title th:text="${pageTitle ?: 'Manage Bookings'}"></title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <style>
    .booking-container { max-width: 900px; margin: 20px auto; background-color: #fff; padding:30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.07); }
    .form-section { margin-bottom: 30px; padding: 20px; background-color: #FDFBF6; border-radius: 8px; }
    .list-section h3 { margin-top:0; font-family: 'Dancing Script', cursive; color: #8C7853; font-size:2em; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; font-family: 'Nunito', sans-serif; }
    th { background-color: #F8F0E3; color: #6F4E37; font-weight: 600;}
    td .btn-sm { padding: 6px 10px; font-size: 0.85em; margin-right: 5px; border-radius: 15px; }
    .status-active { color: green; font-weight: bold; }
    .status-inactive { color: grey; }
    .alert { padding: 15px; margin-bottom: 20px; border: 1px solid transparent; border-radius: .25rem; }
    .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
    .alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;}
    .page-header h1 { margin: 0; }
  </style>
</head>
<body>
<div class="booking-container">
  <div class="page-header">
    <h1 class="page-title" th:text="${pageTitle ?: 'Manage Bookings'}">Manage Bookings</h1>
    <a th:href="@{/}" class="btn btn-secondary" style="padding: 8px 15px;">Back to Dashboard</a>
  </div>


  <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
  <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

  <div class="form-section">
    <h3 style="font-family: 'Dancing Script', cursive; color: #8C7853; font-size:2em;">Add New Booking</h3>
    <form th:action="@{/bookings/add}" th:object="${bookingDto}" method="post">
      <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />
      <div class="form-group">
        <label for="siteName">Site Name:</label>
        <input type="text" id="siteName" th:field="*{siteName}" class="form-control">
        <div th:if="${#fields.hasErrors('siteName')}" th:errors="*{siteName}" class="error-message"></div>
      </div>
      <div class="form-group">
        <label for="siteUrl">Site URL:</label>
        <input type="text" id="siteUrl" th:field="*{siteUrl}" class="form-control">
        <div th:if="${#fields.hasErrors('siteUrl')}" th:errors="*{siteUrl}" class="error-message"></div>
      </div>
      <div class="form-group">
        <label for="loginId">Login ID:</label>
        <input type="text" id="loginId" th:field="*{loginId}" class="form-control">
        <div th:if="${#fields.hasErrors('loginId')}" th:errors="*{loginId}" class="error-message"></div>
      </div>
      <div class="form-group">
        <label for="loginPassword">Password:</label>
        <input type="password" id="loginPassword" th:field="*{loginPassword}" class="form-control">
        <div th:if="${#fields.hasErrors('loginPassword')}" th:errors="*{loginPassword}" class="error-message"></div>
      </div>
      <div class="form-group">
        <label for="bookingTime">Booking Time:</label>
        <input type="datetime-local" id="bookingTime" th:field="*{bookingTime}" class="form-control">
        <div th:if="${#fields.hasErrors('bookingTime')}" th:errors="*{bookingTime}" class="error-message"></div>
      </div>
      <button type="submit" class="btn btn-primary">Add Booking</button>
    </form>
  </div>

  <div class="list-section">
    <h3>My Current Bookings</h3>
    <div th:if="${#lists.isEmpty(bookings)}">
      <p>No bookings found. Add one using the form above!</p>
    </div>
    <table th:unless="${#lists.isEmpty(bookings)}">
      <thead>
      <tr>
        <th>Site Name</th>
        <th>Login ID</th>
        <th>Booking Time</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="booking : ${bookings}">
        <td th:text="${booking.siteName}">Site Alpha</td>
        <td th:text="${booking.loginId}">myIdForAlpha</td> <td th:text="${booking.displayBookingTime}">2025-05-20 10:00</td>
        <td>
          <span th:if="${booking.active}" class="status-active">Active</span>
          <span th:unless="${booking.active}" class="status-inactive">Inactive</span>
        </td>
        <td>
          <a th:href="@{/bookings/{id}/edit(id=${booking.id})}" class="btn btn-secondary btn-sm">Edit</a>

          <form th:action="@{/bookings/{id}/delete(id=${booking.id})}" method="post" style="display: inline-block;" onsubmit="return confirm('Are you sure you want to delete this booking?');">
            <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />
            <button type="submit" class="btn btn-secondary btn-sm" style="background-color: #d9534f; color: white;">Delete</button>
          </form>

          <form th:action="@{/bookings/{id}/toggle-status(id=${booking.id})}" method="post" style="display: inline-block;">
            <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />
            <button type="submit" class="btn btn-secondary btn-sm"
                    th:text="${booking.active ? 'Deactivate' : 'Activate'}"
                    th:style="${booking.active ? 'background-color: #f0ad4e;' : 'background-color: #5cb85c;'} + 'color: white;'">
              Toggle
            </button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
</body>
</html>